<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Ficha de {{ user_name }}</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body{font-family:'Open Sans',sans-serif;background:#0c0e2c;color:#e6e8ef;margin:0}
    header{padding:16px 28px;background:linear-gradient(90deg,#0c0e2c,#003559 55%,#00bfff);box-shadow:0 2px 6px rgba(0,0,0,.45)}
    h1{font-family:'Montserrat',sans-serif;margin:0;font-weight:700}
    .container{max-width:1100px;margin:0 auto;padding:28px 22px}
    .card{background:#fff;color:#222;border-radius:14px;box-shadow:0 10px 28px rgba(0,0,0,.2);padding:18px;margin-bottom:18px;border:1px solid #eef2f7}
    .title{margin:0 0 8px;font:700 18px 'Montserrat',sans-serif;color:#0c0e2c}
    .muted{color:#566}
    .tag{display:inline-block;font-size:12px;padding:3px 8px;border-radius:999px;background:#f1f6ff;color:#003559;border:1px solid #dfe9ff;margin-left:8px}
    .eval{background:#eaf7fb;border-left:6px solid #00a4e6;border-radius:12px;padding:12px;margin-top:10px}
    .eval.rh{background:#fff1f1;border-left-color:#cc0000}
    .tip{background:#f7fbff;border-left:6px solid #00bfff;border-radius:12px;padding:12px;margin-top:10px}
    .chat{margin-top:10px;padding:12px;border-radius:12px;background:#f6f9ff;border:1px solid #e4ecff}
    .bubble{padding:8px 10px;border-radius:10px;margin:6px 0}
    .u{background:rgba(128,90,213,.12);border-left:5px solid #805ad5}
    .d{background:rgba(0,191,255,.12);border-left:5px solid #00bfff}
    a.btn{display:inline-block;background:#00bfff;color:#000;font-weight:700;padding:8px 12px;border-radius:10px;text-decoration:none}
    a.btn:hover{background:#00a4e6}
  </style>
</head>
<body>
  <header>
    <h1>ðŸ‘¤ {{ user_name }} <span class="tag">{{ email }}</span></h1>
  </header>
  <div class="container">
    {% if sessions|length == 0 %}
      <p class="muted">Sin sesiones todavÃ­a.</p>
    {% endif %}

    {% for s in sessions %}
      <div class="card">
        <div class="title">{{ s.scenario or 'SesiÃ³n' }}</div>
        <div class="muted">Fecha: {{ s.timestamp or 'â€”' }}</div>

        {% if s.audio_path %}
          <p style="margin:10px 0">
            <a class="btn" href="/video/{{ s.audio_path|e }}" target="_blank">â–¶ Ver video</a>
          </p>
        {% endif %}

        {% if s.evaluation %}
          <div class="eval">
            <strong>Resumen para usuario</strong><br/>{{ s.evaluation }}
          </div>
        {% endif %}

        {% if s.evaluation_rh %}
          <div class="eval rh">
            <strong>Mensaje de CapacitaciÃ³n</strong><br/>{{ s.evaluation_rh }}
          </div>
        {% endif %}

        {% if s.tip %}<div class="tip"><strong>Tip:</strong> {{ s.tip }}</div>{% endif %}
        {% if s.visual_feedback %}<div class="tip"><strong>Feedback visual:</strong> {{ s.visual_feedback }}</div>{% endif %}

        <div class="chat">
          <div><strong>ConversaciÃ³n</strong></div>
          {% for line in s.user_dialogue %}
            <div class="bubble u">{{ line }}</div>
          {% endfor %}
          {% for line in s.avatar_dialogue %}
            <div class="bubble d">{{ line }}</div>
          {% endfor %}
        </div>

        {% if s.comments_public and s.comments_public|length > 0 %}
          <div class="tip" style="margin-top:12px">
            <strong>Historial de comentarios</strong>
            <ul style="margin:6px 0 0 18px">
              {% for c in s.comments_public %}
                <li><em>{{ c.created }}</em> â€” <strong>{{ c.author }}</strong>: {{ c.body }}</li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
</body>
</html>
